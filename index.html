<!DOCTYPE html>
<html>
    <head>
        <meta charset="UTF-8">
        <link rel="stylesheet" href="style.css">
        
        <title>Kalkulator BMI</title> 
    </head>
        
        <body>
        
            <h1>Kalkulator BMI</h1>
        
        <section>
        <div id="panel-boczny">
            <div id="ramka">
            <p><strong>Podaj swoje parametry</strong></p>
            <p>wzrost:</p>
            <p><input type="text" id="wzrost"></p>
            <p>waga: </p>
            <p><input type="text" id="waga"></p>
            <p><input type="submit" value="Zatwierdź" onclick="wylicz_wynik()"></p>
            </div>
        </div>
        
        <div id="panel-wyniki">
            <p id="komunikat_1"></p>
            <p id="komunikat_2"></p>
            <p id="stan"></p>
            <div id = "chart_div"></div>
            <p id="komunikat_3"></p>
        </div>
        
        <div id="panel-boczny"> 
            <div id="ramka">  
            <p><strong>Archiwum wyników</strong></p>
                <div class="wpisyWynikow"></div>
            </div>
            <div id="ramka">
                <p id="srednia">Średnia wszystkich wyników:</p>
            </div>
            <div id="ramka-jpg">
                <img src="pict.jpg" width="315px" style="border-radius: 15px;">
            </div>
            <div id="ramka">
                <p><input type="submit" value="Usuń wszystkie wyniki z archiwum" onclick="wyczysc_wyniki()"></p>
            </div>
          </div>
        </section>

    <script type="text/javascript" src="gauge.js"></script>
    <script type="text/javascript">

        google.charts.load('current', {'packages':['gauge']});
        google.charts.setOnLoadCallback(ustaw_zegar);
      
        let liczba_1 = document.getElementById('wzrost');
        let liczba_2 = document.getElementById('waga');
        let wyniki= [];
      
        let gaugeOptions = {
            min: 14,
            max: 34,
            width: 400, height: 400,
            greenFrom: 18.5, greenTo: 24.99,
            yellowFrom:25, yellowTo: 29.99,
            redFrom: 30, redTo: 45,
            majorTicks: ['<14', '19', '24', '29', '>34'],
            minorTicks: 25
        };

        let gauge;

        window.onload = zaladuj();

        function wylicz_wynik(){
            let PierwszaLiczba = parseInt(liczba_1.value);
            let DrugaLiczba = parseInt(liczba_2.value);
            let BMI = 0;
                if ((isNaN(PierwszaLiczba) == true) || (isNaN(DrugaLiczba) == true)) {
                    document.getElementById("komunikat_1").innerHTML = "podaj poprawne dane!";
                    zeruj_ustawienia();
                }
                else if ((PierwszaLiczba < 120) || (PierwszaLiczba >240)) {
                    document.getElementById("komunikat_1").innerHTML = "wzrost nie jest poprawny!";
                    zeruj_ustawienia();
                }   
                else if ((DrugaLiczba < 40) || (DrugaLiczba >200)) {
                    document.getElementById("komunikat_1").innerHTML = "waga nie jest poprawna!";
                    zeruj_ustawienia();
                }
                else {
                    BMI = (DrugaLiczba / ((PierwszaLiczba/100) * (PierwszaLiczba/100))).toFixed(2);
                    gaugeData.setValue(0, 0, BMI);
                    gauge.draw(gaugeData, gaugeOptions);
                    
                    const data = new Date();
                    wyniki.push([(wyniki.length + 1) + ": " + data.getFullYear() + "." + (data.getMonth() + 1) + "." + data.getDate() + "-" + 
                            data.getHours() + ":" + data.getMinutes() + ":" + data.getSeconds(), PierwszaLiczba, DrugaLiczba, parseFloat(BMI)]);
      
                    let storage_data = [];
                    let storage_wzrost = [];        
                    let storage_waga = [];
                    let storage_wynik = [];
                    
                    for (i=0; i < wyniki.length; i++){
                        storage_data.push(wyniki[i][0]);
                        storage_wzrost.push(wyniki[i][1]);
                        storage_waga.push(wyniki[i][2]);
                        storage_wynik.push(wyniki[i][3]);
                    }
                        localStorage.setItem("data", storage_data);
                        localStorage.setItem("wzrost", storage_wzrost);
                        localStorage.setItem("waga", storage_waga);
                        localStorage.setItem("wynik", storage_wynik);
                    
                    wpisArchiwum((wyniki[wyniki.length - 1][0]), (wyniki[wyniki.length - 1][1]), 
                                    (wyniki[wyniki.length - 1][2]),(wyniki[wyniki.length - 1][3]));
                    
                    wyswietl_wynik(wyniki.length);
                };    
        };    
            function wyswietl_wynik(parametr){
                let wzrost = (wyniki[parametr - 1][1]);
                let waga = (wyniki[parametr - 1][2]);
                let BMI = (wyniki[parametr - 1][3]);
                czysc_pola();
                gaugeData.setValue(0, 0, BMI);
                gauge.draw(gaugeData, gaugeOptions);
                document.getElementById("komunikat_1").innerHTML = "Wzrost: " + wzrost + "m Waga: " + waga + "kg";
                document.getElementById("komunikat_2").innerHTML = "BMI " + BMI;
                document.getElementById("srednia").innerHTML = "Średnia wszystkich wyników: " + srednia();
                document.getElementById("komunikat_2").style.color = 'rgb(255, 255, 224)';

                    if (BMI <18.5) {
                        document.getElementById("stan").innerHTML = "niedowaga";
                        document.getElementById("stan").style.color = 'rgb(0, 0, 255)';}
                    if ((BMI >=18.5) && (BMI < 25)) {
                        document.getElementById("stan").innerHTML = "waga optymalna";
                        document.getElementById("stan").style.color = 'rgb(25, 248, 25)';}
                    if ((BMI >=25) && (BMI < 30)) {
                        document.getElementById("stan").innerHTML = "nadwaga";
                        document.getElementById("stan").style.color = 'rgb(255, 175, 101)';}
                    if (BMI >30) {
                        document.getElementById("stan").innerHTML = "otyłość :-) niestety";
                        document.getElementById("stan").style.color = 'rgb(255, 150, 150)';} 
                        
                    if (wyniki.length > 1) {
                        let a = (wyniki[(wyniki.length) - 2][3]); 
                        let b = (wyniki[(wyniki.length) - 1][3]);
                        document.getElementById("komunikat_3").innerHTML = ""
                        if (a > b) {document.getElementById("komunikat_3").innerHTML = "Twoje BMI spadło!"};
                        if (a < b) {document.getElementById("komunikat_3").innerHTML = "Twoje BMI wzrosło!"};};
            };
        
            function wpisArchiwum(nowy_tekst, nowy_wzrost, nowa_waga, nowe_BMI){
                const nowyWpisArchiwum = document.createElement("div");
                nowyWpisArchiwum.innerHTML = nowy_tekst +" "+nowy_wzrost+"-"+nowa_waga+" BMI:"+ nowe_BMI;
                document.querySelector(".wpisyWynikow").appendChild(nowyWpisArchiwum);
            };

            function srednia(){
                let suma = 0;
                let srednia = 0;
                for (i=0; i<(wyniki.length); i++) {
                    suma = suma + parseFloat(wyniki[i][3]);
                    srednia = (suma / (wyniki.length)).toFixed(2);}
                return srednia;
            };

            function zeruj_ustawienia(){
                    BMI = 0;
                    gaugeData.setValue(0, 0, 0);
                    gauge.draw(gaugeData, gaugeOptions);
                    document.getElementById("komunikat_2").innerHTML = "";
                    document.getElementById("stan").innerHTML = "";
                    document.getElementById("komunikat_3").innerHTML = "";
            };
            
            function czysc_pola(){
                document.getElementById('wzrost').value="";
                document.getElementById('waga').value="";
            };

            function wyczysc_wyniki(){
                
                let div = document.getElementsByClassName("wpisyWynikow"), child;
                while ((child = div[0].firstChild)) {
                div[0].removeChild(child);
                };

                document.getElementById("komunikat_1").innerHTML = "";
                document.getElementById("komunikat_2").innerHTML = "";
                document.getElementById("stan").innerHTML = "";
                document.getElementById("komunikat_3").innerHTML = "";
                gaugeData.setValue(0, 0, 0);
                gauge.draw(gaugeData, gaugeOptions);
                document.getElementById('srednia').innerHTML = "Średnia wszystkich wyników:";
                
                wyniki.length = 0;
                localStorage.clear();
            };

            function ustaw_zegar(){
                    gaugeData = new google.visualization.DataTable();
                    gaugeData = new google.visualization.DataTable();
                    gaugeData.addColumn('number', 'BMI');
                    gaugeData.addRows(2);
                    gaugeData.setCell(0, 0, 0);
                    gauge = new google.visualization.Gauge(document.getElementById('chart_div'));
                    gauge.draw(gaugeData, gaugeOptions);
            };

            function zaladuj() {
                let get_storage_data = localStorage.getItem("data");
                let get_storage_wzrost = localStorage.getItem("wzrost");
                let get_storage_waga = localStorage.getItem("waga");
                let get_storage_wynik = localStorage.getItem("wynik");

                if (get_storage_data === null) {
                    return;}
                else {
                    get_storage_data = localStorage.getItem("data").split(",");
                    get_storage_wzrost = localStorage.getItem("wzrost").split(",");
                    get_storage_waga = localStorage.getItem("waga").split(",");
                    get_storage_wynik = localStorage.getItem("wynik").split(",");                    
                    for (i=0; i < get_storage_data.length; i++) {
                        wyniki.push([get_storage_data[i], get_storage_wzrost[i], get_storage_waga[i], get_storage_wynik[i]]);
                        wpisArchiwum((wyniki[wyniki.length - 1][0]), (wyniki[wyniki.length - 1][1]), 
                                        (wyniki[wyniki.length - 1][2]),(wyniki[wyniki.length - 1][3]));
                    }
                    document.getElementById("srednia").innerHTML = "Średnia wszystkich wyników: " + srednia();
                }
            };

            let click = document.querySelector(".wpisyWynikow");
            click.onclick = function (a){
            let moj_wybor = 0;    
            let moje_klikniecie = (a.target.innerText);
            if (parseInt(moje_klikniecie.substr(0, 2)) == ":") {moj_wybor = parseInt(moje_klikniecie.substr(0, 1))}
                else if (parseInt(moje_klikniecie.substr(0, 3)) == ":") {moj_wybor = parseInt(moje_klikniecie.substr(0, 2))}
                    else {moj_wybor = parseInt(moje_klikniecie.substr(0, 3))}
            wyswietl_wynik(moj_wybor);
            document.getElementById("komunikat_3").innerHTML = "To jest wynik nr " + moj_wybor + " z archiwum";
            };
        </script>
    </body>
</html>